"use strict";(self.webpackChunkcommerce_php=self.webpackChunkcommerce_php||[]).push([[54196],{64190:function(e,t,a){a.r(t),a.d(t,{_frontmatter:function(){return s},default:function(){return c}});var n,i=a(87462),r=a(63366),o=(a(15007),a(64983)),d=a(91515),l=["components"],s={},p=(n="InlineAlert",function(e){return console.warn("Component "+n+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.mdx)("div",e)}),m={_frontmatter:s},u=d.Z;function c(e){var t=e.components,a=(0,r.Z)(e,l);return(0,o.mdx)(u,(0,i.Z)({},m,a,{components:t,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"add-custom-shipping-carrier-validations"},"Add custom shipping carrier validations"),(0,o.mdx)("p",null,"This topic describes how to add shipping address validations for a custom ",(0,o.mdx)("a",{parentName:"p",href:"https://glossary.magento.com/shipping-carrier"},"shipping carrier")," to the ",(0,o.mdx)("a",{parentName:"p",href:"https://glossary.magento.com/checkout"},"checkout"),". This is an essential part of the bigger task of adding a custom shipping method to your store."),(0,o.mdx)("p",null,"To add new shipping carrier validations to the checkout, do the following:"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("a",{parentName:"li",href:"#step-1-create-validation-rules"},"Create validation rules"),"."),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("a",{parentName:"li",href:"#step-2-create-validator"},"Create validator"),"."),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("a",{parentName:"li",href:"#step-3-register-validator-and-rules-in-the-validators-pool"},"Register validator and rules in the validators pool"),"."),(0,o.mdx)("li",{parentName:"ol"},(0,o.mdx)("a",{parentName:"li",href:"#step-4-add-the-validation-to-the-checkout-layout"},"Add the validators and rules to the checkout layout"),".")),(0,o.mdx)(p,{variant:"info",slots:"text",mdxType:"InlineAlert"}),(0,o.mdx)("p",null,"During checkout, when a customer fills the shipping address form, shipping carrier validations trigger the shipping rates request. That is why adding shipping carrier validations for your custom shipping method is mandatory."),(0,o.mdx)("h2",{id:"step-1-create-validation-rules"},"Step 1: Create validation rules"),(0,o.mdx)("p",null,"Shipping carrier validation rules declare which fields of the shipping address are required for the corresponding shipping method to be available. The validation itself is performed by the ",(0,o.mdx)("a",{parentName:"p",href:"#step-2-create-validator"},"validator"),"."),(0,o.mdx)("p",null,"During checkout, if the shipping address fields declared in the rules are filled, the further validation of fields' values is carried on the ",(0,o.mdx)("a",{parentName:"p",href:"https://glossary.magento.com/server-side"},"server side"),". For example, whether a carrier is available for the specified country."),(0,o.mdx)("p",null,"For the sake of compatibility, upgradability, and easy maintenance, do not edit the default application code, add your customization in a separate module. For your checkout customization to be applied correctly, your custom module should ",(0,o.mdx)("a",{parentName:"p",href:"../../development/build/composer-integration.md"},"depend")," on the ",(0,o.mdx)("inlineCode",{parentName:"p"},"Magento_Checkout")," module."),(0,o.mdx)("p",null,"Do not use ",(0,o.mdx)("inlineCode",{parentName:"p"},"Ui")," for your custom module name, because ",(0,o.mdx)("inlineCode",{parentName:"p"},"%Vendor%_Ui")," notation, required when specifying paths, might cause issues."),(0,o.mdx)("p",null,"In your ",(0,o.mdx)("inlineCode",{parentName:"p"},"<your_module_dir>/view/frontend/web/js/model")," directory, create a ",(0,o.mdx)("inlineCode",{parentName:"p"},".js")," file implementing the validation rules."),(0,o.mdx)("p",null,"The script must implement the ",(0,o.mdx)("inlineCode",{parentName:"p"},"getRules()")," method."),(0,o.mdx)("p",null,"For example, the FedEx shipping method requires only two fields of the shipping address to be filled: ",(0,o.mdx)("strong",{parentName:"p"},"Country"),", ",(0,o.mdx)("strong",{parentName:"p"},"Zip Code")," and ",(0,o.mdx)("strong",{parentName:"p"},"City"),". This is how the validation rules for FedEx look:"),(0,o.mdx)("blockquote",null,(0,o.mdx)("p",{parentName:"blockquote"},(0,o.mdx)("em",{parentName:"p"},"<Magento_Fedex_dir>/view/frontend/web/js/model/shipping-rates-validation-rules.js"))),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"define(\n    [],\n    function () {\n        'use strict';\n        return {\n            getRules: function() {\n                return {\n                    'postcode': {\n                        'required': true\n                    },\n                    'country_id': {\n                        'required': true\n                    },\n                    'city': {\n                        'required': true\n                    }\n                };\n            }\n        };\n    }\n)\n")),(0,o.mdx)("p",null,"Triggering the shipping rates request correlates directly with the fields you specify in the validation rules: the request is triggered once all these fields are populated and pass the validation."),(0,o.mdx)("h2",{id:"step-2-create-validator"},"Step 2: Create validator"),(0,o.mdx)("p",null,"Create the validator ",(0,o.mdx)("inlineCode",{parentName:"p"},".js")," script that checks if the fields defined by the validation rules are filled. The script must be located in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"<your_module_dir>/view/frontend/web/js/model")," directory."),(0,o.mdx)("p",null,"A sample validator script follows:"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"define(\n    [\n        'jquery',\n        'mageUtils',\n\n        './shipping-rates-validation-rules',\n        'mage/translate'\n    ],\n    function ($, utils, validationRules, $t) {\n        'use strict';\n        return {\n            validationErrors: [],\n            validate: function(address) {\n                var self = this;\n                this.validationErrors = [];\n                $.each(validationRules.getRules(), function(field, rule) {\n                    if (rule.required && utils.isEmpty(address[field])) {\n                        var message = $t('Field ') + field + $t(' is required.');\n                        self.validationErrors.push(message);\n                    }\n                });\n                return !Boolean(this.validationErrors.length);\n            }\n        };\n    }\n);\n")),(0,o.mdx)("p",null,"You can use this sample for your validator, but you need to specify your validation rules script instead of ",(0,o.mdx)("inlineCode",{parentName:"p"},"./shipping-rates-validation-rules")," in the list of used modules."),(0,o.mdx)("h2",{id:"step-3-register-validator-and-rules-in-the-validators-pool"},"Step 3: Register validator and rules in the validators pool"),(0,o.mdx)("p",null,"Your custom validator must be added to the pool of validators. To do this, in the ",(0,o.mdx)("inlineCode",{parentName:"p"},"<your_module_dir>/view/frontend/web/js/view")," directory create a new ",(0,o.mdx)("inlineCode",{parentName:"p"},"<your-validation>.js")," file with the following content (having replaced the ",(0,o.mdx)("inlineCode",{parentName:"p"},"<your_validator>")," and ",(0,o.mdx)("inlineCode",{parentName:"p"},"<your_validation_rules>")," with your values):"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-js"},"define(\n    [\n        'uiComponent',\n        'Magento_Checkout/js/model/shipping-rates-validator',\n        'Magento_Checkout/js/model/shipping-rates-validation-rules',\n        '../model/<your_validator>',\n        '../model/<your_validation_rules>'\n    ],\n    function (\n        Component,\n        defaultShippingRatesValidator,\n        defaultShippingRatesValidationRules,\n        shippingRatesValidator,\n        shippingRatesValidationRules\n    ) {\n        'use strict';\n        defaultShippingRatesValidator.registerValidator('carrierName', shippingRatesValidator);\n        defaultShippingRatesValidationRules.registerRules('carrierName', shippingRatesValidationRules);\n        return Component;\n    }\n);\n")),(0,o.mdx)("h2",{id:"step-4-add-the-validation-to-the-checkout-layout"},"Step 4: Add the validation to the checkout layout"),(0,o.mdx)("p",null,"The last step is specifying the script you created on the previous step in the checkout page ",(0,o.mdx)("a",{parentName:"p",href:"https://glossary.magento.com/layout"},"layout"),"."),(0,o.mdx)("p",null,"In your custom module directory, create a new ",(0,o.mdx)("inlineCode",{parentName:"p"},"<your_module_dir>/view/frontend/layout/checkout_index_index.xml")," file."),(0,o.mdx)("p",null,"In this file, add the following:"),(0,o.mdx)("p",null,"You must add ",(0,o.mdx)("inlineCode",{parentName:"p"},"<your-validation-name>")," like ",(0,o.mdx)("inlineCode",{parentName:"p"},"%carrier%-rates-validation")," - where carrier has to match the actual carrier code."),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-xml"},'<page xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:View/Layout/etc/page_configuration.xsd">\n    <body>\n        <referenceBlock name="checkout.root">\n            <arguments>\n                <argument name="jsLayout" xsi:type="array">\n                    <item name="components" xsi:type="array">\n                        <item name="checkout" xsi:type="array">\n                            <item name="children" xsi:type="array">\n                                <item name="steps" xsi:type="array">\n                                    <item name="children" xsi:type="array">\n                                        <item name="shipping-step" xsi:type="array">\n                                            <item name="children" xsi:type="array">\n                                                <item name="step-config" xsi:type="array">\n                                                    <item name="children" xsi:type="array">\n                                                        <item name="shipping-rates-validation" xsi:type="array">\n                                                            <item name="children" xsi:type="array">\n                                                                <item name="<your-validation-name>" xsi:type="array">\n                                                                    <item name="component" xsi:type="string">%your_module%/js/view/%your-validation%</item>\n                                                                </item>\n                                                            </item>\n                                                        </item>\n                                                    </item>\n                                                </item>\n                                            </item>\n                                        </item>\n                                    </item>\n                                </item>\n                            </item>\n                        </item>\n                    </item>\n                </argument>\n            </arguments>\n        </referenceBlock>\n    </body>\n</page>\n')),(0,o.mdx)("h2",{id:"step-5-deploy-static-content-and-clear-the-cache"},"Step 5: Deploy static content and clear the cache"),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Deploy static content:")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento setup:static-content:deploy\n")),(0,o.mdx)("ol",null,(0,o.mdx)("li",{parentName:"ol"},"Clean the cache:")),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"bin/magento cache:clean\n")))}c.isMDXComponent=!0}}]);
//# sourceMappingURL=component---src-pages-tutorials-custom-checkout-add-carrier-validation-md-a64fe5e4b2eb0281d404.js.map